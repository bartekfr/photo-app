angular.module("admin",[]).controller("adminCtrl",["$scope",function(){}]).controller("addCtrl",["$scope","reports",function(a,b){a.report={data:[],title:""},a.save=function(){b.save(a.report)}}]).controller("editCtrl",["$scope","report","$state",function(a,b,c){a.reportData=b.data,a.title=b.title,a.report=b,a.message="aaa",a.remove=function(){b.$delete(function(){c.go("home")})},a.saveProperties=function(){b.title=a.title,a.$emit("requestSent","Sending request..."),b.$update(function(){a.$emit("requestSent","Report properties saved")})}}]),angular.module("home",[]).controller("homeCtrl",["$scope","reports",function(a,b){a.reports=b}]),angular.module("reportsApp",["ui.router","ngResource","filters","directives","services","home","report","admin"]).constant("MONGOLAB_CONFIG",{DB_NAME:"reportsdb",API_KEY:"qUxqL9tqS3G-MbTZLJgdH8Ob4e1Yve_p"}).factory("reportsCollection",["reportsDbResource",function(a){return a("reports")}]).config(["$stateProvider","$locationProvider","$urlRouterProvider",function(a,b,c){c.otherwise("/home"),a.state("home",{url:"/home",templateUrl:"dist/tpl/home/home.html",resolve:{reports:["reportsCollection",function(a){return a.query().$promise}]},controller:"homeCtrl",data:{title:"Home page"}}).state("report",{url:"/report/:id",templateUrl:"dist/tpl/report/report.html",controller:"reportCtrl",resolve:{report:["reportsCollection","$stateParams",function(a,b){var c=b.id;return a.get({id:c}).$promise}]},data:{title:"Month report"}}).state("admin",{url:"/admin",templateUrl:"dist/tpl/admin/admin.html",controller:"adminCtrl",resolve:{token:["authenticate",function(a){var b=a.validateToken();return b.error(function(){console.log("bad token"),a.logout()}),b}]},data:{restricted:!0}}).state("admin.add",{url:"/add",templateUrl:"dist/tpl/admin/add.html",controller:"addCtrl",resolve:{reports:"reportsCollection"},data:{title:"Add new report:)"}}).state("admin.edit",{url:"/edit/:id",templateUrl:"dist/tpl/admin/edit.html",controller:"editCtrl",resolve:{report:["reportsCollection","$stateParams",function(a,b){var c=b.id;return a.get({id:c}).$promise}]},data:{title:"Edit report data",restricted:!0}})}]).run(["$rootScope","$state","$stateParams","$http","authenticate",function(a,b,c){a.$state=b,a.$stateParams=c;var d=document.querySelector("body");a.$on("$stateChangeStart",function(a,c){d.classList.add("loading");var e=c.data.restricted;e&&null===localStorage.getItem("token")&&(a.preventDefault(),d.classList.remove("loading"),b.go("home"),console.log("no token, back home"))}),a.$on("$stateChangeSuccess",function(){d.classList.remove("loading"),console.log("change state")}),a.$on("$stateChangeError",function(){d.classList.remove("loading"),console.log("change state error")})}]).controller("main",["$scope","$state","authenticate","$timeout","$rootScope",function(a,b,c,d,e){e.logged=null!==localStorage.getItem("token"),a.logout=function(){c.logout()},a.login=function(){c.login()},a.$on("requestSent",function(b,c){a.message=c,d(function(){a.message=""},3e3)})}]),angular.module("report",[]).controller("reportCtrl",["$scope","report",function(a,b){a.reportData=b.data,a.title=b.title,a.report=b}]);