angular.module("directives",[]).directive("chart",[function(){function a(a,b,c){var d=c.width,e=c.height,f=c.type,g={top:20,right:30,bottom:30,left:60},h=d-g.left-g.right,i=e-g.top-g.bottom,j="line"===f,k=d3.scale.ordinal().domain(b.map(function(a){return a.month}));j?k.rangePoints([0,h],0):k.rangeRoundBands([0,h],.1);var l=d3.scale.linear().domain([d3.min(b,function(a){return a.value}),d3.max(b,function(a){return a.value})]).range([i,0]),m=d3.svg.axis().scale(k).orient("top"),n=d3.svg.axis().scale(l).ticks(10).tickSize(-h,0).orient("left"),o=d3.select(a).append("svg").attr("width",d).attr("height",e).append("g").attr("transform","translate("+g.left+","+g.top+")");if(o.append("g").attr("class","y axis").call(n).append("text").attr("transform","rotate(-90)").attr("y",-40).attr("dy",".71em").style("text-anchor","end").text("Billions of dollars"),j){var p=d3.svg.line().x(function(a){return k(a.month)}).y(function(a){return l(a.value)});o.append("path").attr("class","line").attr("d",function(){return p(b)}),o.selectAll("circle").data(b).enter().append("circle").attr("cx",function(a){return k(a.month)}).attr("cy",function(a){return l(a.value)}).attr("r",3)}else o.selectAll("rect").data(b).enter().append("g").attr("transform",function(a){return"translate("+k(a.month)+",0)"}).append("rect").attr("class","bar").attr("y",function(a){return value=a.value,l(value>=0?value:0)}).attr("width",k.rangeBand()).attr("height",0).attr("height",function(a){return Math.abs(l(0)-l(a.value))});var q=o.append("g");q.attr("class","x axis").attr("transform","translate(0,"+parseInt(l(0))+")").call(m).append("text").attr("x",h).attr("y",10).attr("dy",".71em").style("text-anchor","end").text("[months]"),q.selectAll(".tick text").style("text-anchor",j?"start":"middle")}return{restrict:"AE",templateUrl:"dist/tpl/directives/chart-directive.html",replace:!0,scope:{data:"=sourceData"},link:function(b,c,d){function e(){c.find("svg").remove(),a(c[0],b.data,{type:b.chartType,width:d.width,height:d.height})}b.chartTypes=["line","bar"],b.chartType=b.chartTypes[1],b.$watch("data",function(a){b.data=a,a.length&&e()},!0),b.$watch("chartType",function(){e()})}}}]),angular.module("filters",[]).filter("capitalize",function(){return function(a){function b(a){var b=a.toLowerCase();return b.replace(/(^| )(\w)/g,function(a){return a.toUpperCase()})}return b(a)}}),angular.module("services",[]).factory("reportsDbResource",["$resource","MONGOLAB_CONFIG",function(a,b){return function(c){return a("https://api.mongolab.com/api/1/databases/reportsdb/collections/"+c+"/:id",{apiKey:b.API_KEY,id:"@_id.$oid"},{save:{method:"PUT"}})}}]);